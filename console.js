!function(){"use strict";class t{constructor(t){this.online=!1,this.ctex=t,this.x=0,this.y=0,this.velX=0,this.velY=0,this.health=100,this.speed=1,this.img=new Image,this.img.src="./assets/spaceship.png"}draw(){for(let t in this.ctex){let e=this.ctex[t];e.fillStyle="gold",e.drawImage(this.img,this.x,this.y)}}update(){this.x+=this.velX*this.speed,this.y+=this.velY*this.speed}}class e{constructor(t){this.ctex=t,this.x=0,this.y=0,this.velX=0,this.velY=0,this.img=document.getElementById("cursor")}draw(){for(let t in this.ctex){this.ctex[t].drawImage(this.img,this.x,this.y)}}update(){this.x+=1.5*this.velX,this.y+=1.5*this.velY}}class i{constructor(t,e,i,s,l){this.ctex=t,this.x=e,this.y=i,this.dirX=s,this.dirY=l,this.life=3}draw(){for(let t in this.ctex){let e=this.ctex[t];e.beginPath(),e.strokeStyle="red",e.fillStyle="orange",e.arc(this.x,this.y,5,0,2*Math.PI),e.fill()}}update(){this.x+=this.dirX/30,this.y+=this.dirY/30}}class s{constructor(t,e){e=e||{},this.distance=1e3,this.lookat=[0,0],this.context=t,this.fieldOfView=e.fieldOfView||Math.PI/4,this.viewport={left:0,right:0,top:0,bottom:0,width:0,height:0,scale:[1,1]},this.update()}begin(){this.context.save(),this.applyScale(),this.applyTranslation()}end(){this.context.restore()}applyScale(){this.context.scale(this.viewport.scale[0],this.viewport.scale[1])}applyTranslation(){this.context.translate(-this.viewport.left,-this.viewport.top)}update(){this.aspectRatio=this.context.canvas.width/this.context.canvas.height,this.viewport.width=this.distance*Math.tan(this.fieldOfView),this.viewport.height=this.viewport.width/this.aspectRatio,this.viewport.left=this.lookat[0]-this.viewport.width/2,this.viewport.top=this.lookat[1]-this.viewport.height/2,this.viewport.right=this.viewport.left+this.viewport.width,this.viewport.bottom=this.viewport.top+this.viewport.height,this.viewport.scale[0]=this.context.canvas.width/this.viewport.width,this.viewport.scale[1]=this.context.canvas.height/this.viewport.height}zoomTo(t){this.distance=t,this.update()}moveTo(t,e){this.lookat[0]=t,this.lookat[1]=e,this.update()}screenToWorld(t,e,i){return(i=i||{}).x=t/this.viewport.scale[0]+this.viewport.left,i.y=e/this.viewport.scale[1]+this.viewport.top,i}worldToScreen(t,e,i){return(i=i||{}).x=(t-this.viewport.left)*this.viewport.scale[0],i.y=(e-this.viewport.top)*this.viewport.scale[1],i}}class l{constructor(){this.x=0,this.y=0,this.ctx1=document.getElementById("canvas1").getContext("2d"),this.ctx2=document.getElementById("canvas2").getContext("2d"),this.ctx3=document.getElementById("canvas3").getContext("2d"),this.ctx4=document.getElementById("canvas4").getContext("2d"),this.velX=0,this.velY=0,this.health=100}draw(){this.ctx1.fillStyle="red",this.ctx1.fillRect(this.x,this.y,50,50),this.ctx2.fillStyle="red",this.ctx2.fillRect(this.x,this.y,50,50),this.ctx3.fillStyle="red",this.ctx3.fillRect(this.x,this.y,50,50),this.ctx4.fillStyle="red",this.ctx4.fillRect(this.x,this.y,50,50)}update(){this.x+=this.velX,this.y+=this.velY}moveTo(t,e){var i=t-this.x,s=e-this.y,l=Math.sqrt(i*i+s*s);l&&(i/=l,s/=l),this.x+=1*i,this.y+=1*s}getClosestPlayer(t){let e=null,i={x:0,y:0};for(let s of t)if(s.online)if(null==e)e=Math.sqrt(s.x-this.x^s.y-this.y+2^2),i.x=s.x,i.y=s.y;else{let t=Math.sqrt(s.x-this.x^s.y-this.y+2^2);t<e&&(e=t,i.x=s.x,i.y=s.y)}return i}}class h{constructor(t,e,i){this.ctex=t,this.x=e,this.y=i,this.life=1,setInterval(()=>{if(this.life>0)switch(this.life){case 1:this.life=.5;break;case.5:this.life=.25;break;case.25:this.life=0}},1e3)}draw(){for(let t in this.ctex){let e=this.ctex[t];e.fillStyle="aqua",e.fillRect(this.x,this.y,10,10,this.life)}}}let n=new class{constructor(){this.buttons=["button_1","button_2","button_3","button_4","shoulder_top_left","shoulder_top_right","shoulder_bottom_left","shoulder_bottom_right","select","start","stick_button_left","stick_button_right","stick_axis_left","stick_axis_right","d_pad_up","d_pad_down","d_pad_left","d_pad_right","vendor"],this.activeButtons={button_1:!1,button_2:!1,button_3:!1,button_4:!1,shoulder_top_left:!1,shoulder_top_right:!1,shoulder_bottom_left:!1,shoulder_bottom_right:!1,select:!1,start:!1,stick_button_left:!1,stick_button_right:!1,stick_axis_left:!1,stick_axis_right:!1,d_pad_up:!1,d_pad_down:!1,d_pad_left:!1,d_pad_right:!1,vendor:!1}}},o=new Gamepad,r=[document.getElementById("canvas1"),document.getElementById("canvas2"),document.getElementById("canvas3"),document.getElementById("canvas4")],a=[];for(let t of r)t.style.display="none",t.width=window.innerWidth,t.height=window.innerHeight,a.push(t.getContext("2d"));let d=[];for(let t of a)d.push(new s(t));let c=[],w=[],p=[],y=[],u=[];function x(){for(let t in a){let e=a[t];switch(e.clearRect(0,0,window.innerWidth,window.innerHeight),t){case 1:e.fillStyle="white";break;case 2:e.fillRect="silver";break;case 3:e.fillStyle="teal";break;case 4:e.fillStyle="navy"}e.fillRect(0,0,window.innerWidth,window.innerHeight)}for(let t in d){let e=d[t];e.begin(),e.moveTo(c[t].x,c[t].y)}for(let t of c)t.online&&(t.update(),t.draw());for(let t of w)t.online&&(t.update(),t.draw());for(let t of p)t.life>0&&(t.update(),t.draw());for(let t of y){let e=t.getClosestPlayer(c);t.moveTo(e.x,e.y),t.draw()}for(let t of u)t.life>0&&t.draw();for(let t of d)t.end();requestAnimationFrame(x)}function f(){let t=0;for(let e in c)c[e].online&&t++;switch(t){case 1:r[0].style.display="block",r[1].style.display="none",r[2].style.display="none",r[3].style.display="none",r[0].width=window.innerWidth,r[0].height=window.innerHeight;break;case 2:r[1].style.display="block",r[2].style.display="none",canvas4.style.display="none",r[0].width=window.innerWidth/2,r[0].height=window.innerHeight,r[1].width=window.innerWidth/2,r[1].height=window.innerHeight,r[1].style.right="0px";break;case 3:r[2].style.display="block",r[3].style.display="none",r[0].width=window.innerWidth/2,r[0].height=window.innerHeight/2,r[1].width=window.innerWidth/2,r[1].height=window.innerHeight/2,r[1].style.right="0px",r[2].width=window.innerWidth/2,r[2].height=window.innerHeight/2,r[2].style.left="0px",r[2].style.bottom="0px";break;case 4:r[3].style.display="block",r[0].width=window.innerWidth/2,r[0].height=window.innerHeight/2,r[1].width=window.innerWidth/2,r[1].height=window.innerHeight/2,r[1].style.right="0px",r[1].style.top="0px",r[2].width=window.innerWidth/2,r[2].height=window.innerHeight/2,r[1].style.left="0px",r[1].style.bottom="0px",r[3].width=window.innerWidth/2,r[3].height=window.innerHeight/2,r[1].style.right="0px",r[1].style.bottom="0px"}}function v(){let t=new l;y.push(t)}window.onload=()=>{!function(){for(let i=0;i<4;i++)c.push(new t(a)),w.push(new e(a));o.on("connect",t=>{c[t.index].online=!0,w[t.index].online=!0,console.log(`Controller ${t.index+1} has been connected`),f()}),o.on("disconnect",t=>{c[t.index].online=!1,w[t.index].online=!1,console.log(`Controller ${t.index+1} has been disconnected`),f()});for(let t in n.buttons){let e=n.buttons[t];o.on("press",e,t=>{c[t.player].online&&("button_1"==e&&(c[t.player].speed=2.5,u.push(new h(a,c[t.player].x,c[t.player].y))),"shoulder_bottom_right"==e&&p.push(new i(c[t.player].x,c[t.player].y,w[t.player].x-c[t.player].x,w[t.player].y-c[t.player].y)),t.value&&("stick_axis_left"==e?(c[t.player].velX=Math.round(t.value[0]),c[t.player].velY=Math.round(t.value[1])):"stick_axis_right"==e&&(w[t.player].velX=Math.round(t.value[0]),w[t.player].velY=Math.round(t.value[1]))))}),o.on("hold",e,t=>{c[t.player].online&&("button_1"==e&&(c[t.player].speed=2.5,u.push(new h(a,c[t.player].x,c[t.player].y))),t.value&&("stick_axis_left"==e?(c[t.player].velX=Math.round(t.value[0]),c[t.player].velY=Math.round(t.value[1])):"stick_axis_right"==e&&(w[t.player].velX=Math.round(t.value[0]),w[t.player].velY=Math.round(t.value[1]))))}),o.on("release",e,t=>{c[t.player].online&&("button_1"==e&&(c[t.player].speed=1),t.value&&("stick_axis_left"==e?(c[t.player].velX=Math.round(t.value[0]),c[t.player].velY=Math.round(t.value[1])):"stick_axis_right"==e&&(w[t.player].velX=Math.round(t.value[0]),w[t.player].velY=Math.round(t.value[1]))))})}v(),setInterval(v,3e4),setInterval(()=>{for(let t of p)t.life--},1e3),requestAnimationFrame(x)}()},window.onresize=()=>{for(let t of r)t.width=window.innerWidth,t.height=window.innerHeight;for(let t of d)t.update();f()}}();